<div class="client-list-container">
  <!-- Migas de pan -->
  <nav class="breadcrumb-nav">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a href="#" class="breadcrumb-link">Inicio</a>
      </li>
      <li class="breadcrumb-item">
        <a href="#" class="breadcrumb-link">Solicitudes</a>
      </li>
      <li class="breadcrumb-item active">Lista de Solicitudes</li>
    </ol>
  </nav>

  <header class="admin-header">
    <h1 class="reset-title">Gestión de Solicitudes</h1>
  </header>

  <div class="main-content-vertical">
    <!-- Tabla de solicitudes confirmadas -->
    <section class="tabla-section-vertical">
      <div class="tabla-header">
        <h3>Listado de solicitudes nuevas</h3>
        <div class="botones-filtros">
          <button class="btn btn-outline btn-sm" (click)="cargarSolicitudesPendientes()" [disabled]="cargando">
            <i class="fas fa-sync-alt" [class.fa-spin]="cargando"></i>
            {{ cargando ? 'Cargando...' : 'Actualizar' }}
          </button>
        </div>
      </div>

      <div class="table-container-vertical">
        <table class="table">
          <thead>
            <tr>
              <th scope="col" class="id_solicitud">ID</th>
              <th>Nombre de cliente</th>
              <th>Tipo Solicitud</th>
              <th>Monto Solicitado</th>
              <th>Aliada</th>
              <th>Nombre del Aval</th>
              <th>Observaciones</th>
              <th>Domiciliación</th>
              <th class="actions-cell">Acción</th>
            </tr>
          </thead>
          <tbody>
            <!-- Estado de carga -->
            <tr *ngIf="cargando">
              <td colspan="7" class="text-center">
                <i class="fas fa-spinner fa-spin"></i> Cargando solicitudes...
              </td>
            </tr>

            <!-- Sin solicitudes -->
            <tr *ngIf="!cargando && solicitudesPendientes.length === 0">
              <td colspan="7" class="text-center">
                No hay solicitudes pendientes
              </td>
            </tr>

            <!-- Lista de solicitudes -->
            <tr *ngFor="let solicitud of solicitudesPendientes">
              <td>{{ solicitud.id_solicitud }}</td>
              <td>{{ getNombreCompleto(solicitud) }}</td>
              <td>{{ solicitud.tipo_credito }}</td>
              <td>{{ formatearMoneda(solicitud.monto_solicitado) }}</td>
              <td class="aliado-info" [title]="solicitud.aliado_id ? '' + solicitud.aliado_id : 'Sin aliado'">
                {{ solicitud.nombre_aliado || 'No asignado' }}
              </td>
              <td class="aval-info" [title]="solicitud.aval_id ? '' + solicitud.aval_id : 'Sin aval'">
                {{ getNombreAval(solicitud) }}
              </td>
              <td>{{ solicitud.observaciones || 'N/A'}}</td>
              <td>
                <span class="badge" [ngClass]="getClaseBadgeDomiciliacion(solicitud)">
                  {{ getTextoDomiciliacion(solicitud) }}
                </span>
              </td>

              <td class="actions-cell text-center">
                <button class="btn btn-primary btn-sm" (click)="abrirModal(solicitud)">
                  Ver
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>

  <!-- Modal de Detalles -->
  <div class="modal-overlay" *ngIf="modalAbierto">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">
          <i class="fas fa-file-alt"></i>
          Detalles de la Solicitud #{{ solicitudSeleccionada?.id_solicitud }}
        </h3>
        <button class="modal-close" (click)="cerrarModal()" [disabled]="cargandoAprobacion">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <!-- Información de la solicitud -->
        <div class="info-section">
          <h4>Información de la Solicitud</h4>
          <div class="info-grid">
            <div class="info-item">
              <label>Cliente:</label>
              <span>{{ getNombreCompleto(solicitudSeleccionada) }}</span>
            </div>
            <div class="info-item">
              <label>Monto Solicitado:</label>
              <span>{{ formatearMoneda(solicitudSeleccionada?.monto_solicitado) }}</span>
            </div>
            <div class="info-item">
              <label>Plazo:</label>
              <span>{{ solicitudSeleccionada?.plazo_meses }} meses</span>
            </div>
            <div class="info-item">
              <label>Número de Pagos:</label>
              <span>{{ solicitudSeleccionada?.no_pagos }}</span>
            </div>
            <div class="info-item">
              <label>Tipo de Crédito:</label>
              <span>{{ solicitudSeleccionada?.tipo_credito }}</span>
            </div>
            <div class="info-item">
              <label>Fecha de Creación:</label>
              <span>{{ solicitudSeleccionada?.fecha_creacion | date:'dd/MM/yyyy' }}</span>
            </div>
          </div>
        </div>

        <!-- Domiciliacion -->
        <div class="info-item">
          <label>Domiciliación:</label>
          <span>
            <span class="badge" [ngClass]="getClaseBadgeDomiciliacion(solicitudSeleccionada)">
              {{ getTextoDomiciliacion(solicitudSeleccionada) }}
            </span>
            <div class="text-muted small" *ngIf="!cargandoAprobacion" style="margin-top:6px;">
              {{ getDetalleDomiciliacion(solicitudSeleccionada) }}
            </div>
          </span>
        </div>

        <!-- Aprobación y Monto -->
        <div class="md-6">
          <div class="info-section aprobacion-section">
            <h4>Monto aprobado</h4>
            <div class="info-grid-detalle">
              <div class="monto-centrado">
                <div class="monto-input-container">
                  <span class="currency-symbol">$</span>
                  <input type="number" class="form-control monto-input" placeholder="0.00" min="0" step="0.01"
                    max="{{ solicitudSeleccionada?.monto_solicitado }}" [(ngModel)]="montoAprobado"
                    [disabled]="cargandoAprobacion">
                </div>
                <small class="text-muted">
                  Máximo: {{ formatearMoneda(solicitudSeleccionada?.monto_solicitado) }}
                </small>
              </div>
              <div class="acciones-aprobacion">
                <span class="botones-accion">
                  <button class="btn btn-success btn-action" (click)="aprobarSolicitud()"
                    [disabled]="!montoAprobado || montoAprobado <= 0 || cargandoAprobacion">
                    <i class="fas fa-check" [class.fa-spin]="cargandoAprobacion"></i>
                    {{ cargandoAprobacion ? 'Procesando...' : 'Aprobar Solicitud' }}
                  </button>
                  <button class="btn btn-rechazar btn-action" (click)="rechazarSolicitud()"
                    [disabled]="cargandoAprobacion">
                    <i class="fas fa-times"></i> Rechazar
                  </button>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="cerrarModal()" [disabled]="cargandoAprobacion">
          <i class="fas fa-times"></i> Cerrar
        </button>
      </div>
    </div>
  </div>
</div>