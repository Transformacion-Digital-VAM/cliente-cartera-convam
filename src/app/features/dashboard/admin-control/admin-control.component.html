<div class="admin-container">
  <!-- Mensaje de éxito/error -->
  <div *ngIf="showSuccessMessage" class="success-message">
    <div class="success-icon">
      <i class="fas" 
         [class.fa-check-circle]="!isLoading" 
         [class.fa-spinner]="isLoading" 
         [class.fa-spin]="isLoading"></i>
    </div>
    <h3>{{ isLoading ? 'Procesando...' : '¡Operación Exitosa!' }}</h3>
    <div class="email-sent">
      {{ successMessage }}
    </div>
  </div>

  <div class="admin-header">
    <h1 class="reset-title">Panel de Administración</h1>
    <p class="signup-prompt">Gestiona los usuarios del sistema</p>
  </div>

  <div class="admin-content">
    <!-- Loading indicator -->
    <div *ngIf="isLoading && !showAddUserForm" class="loading-indicator">
      <i class="fas fa-spinner fa-spin"></i> Cargando...
    </div>

    <!-- Botón para agregar usuario -->
    <div class="action-bar">
      <button class="btn btn-primary new" (click)="goToRegister(); $event.preventDefault()" [disabled]="isLoading">
        <i class="fas fa-user-plus"></i>
        Agregar Usuario
      </button>
      <button class="btn btn-primary new-passw" (click)="goToRecovery(); $event.preventDefault()" [disabled]="isLoading">
        <i class="fas fa-user-plus"></i>
        Recuperar Contraseña
      </button>
    </div>

    <!-- Lista de usuarios -->
    <div class="users-list" *ngIf="!isLoading">
      <h3>Lista de Usuarios ({{ users.length }})</h3>
      
      <div *ngIf="users.length === 0" class="no-users">
        <p>No hay usuarios registrados</p>
      </div>
      
      <div class="user-card" *ngFor="let user of users">
        <div class="user-info">
          <div class="user-main">
            <h4>{{ user.nombre }}</h4>
            <p class="user-email">{{ user.usuario }}</p>
          </div>
          <div class="user-details">
            <span class="user-role" [class.admin]="user.rol_id === 1 || user.rol_id === 4">
              {{ getRoleName(user.rol_id) }}
            </span>
            <span class="user-date">
              {{ user.created_at | date:'dd/MM/yyyy' }}
            </span>
          </div>
        </div>
        
        <div class="user-actions">
          <button class="btn-action view" (click)="viewUser(user)" title="Ver detalles" [disabled]="isLoading">
            <i class="fas fa-eye"></i>
          </button>
          <button class="btn-action reset" (click)="resetPassword(user)" title="Restablecer contraseña" [disabled]="isLoading">
            <i class="fas fa-key"></i>
          </button>
          <button class="btn-action delete" (click)="deleteUser(user)" title="Eliminar usuario" [disabled]="isLoading">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Detalles del usuario -->
<!-- En el modal de detalles -->
    <div *ngIf="selectedUser" class="user-details-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Detalles del Usuario</h3>
          <button class="close-btn" (click)="closeUserDetails()" [disabled]="isLoading">&times;</button>
        </div>
        
        <div class="modal-body">
          <div class="detail-item">
            <strong>Nombre:</strong> {{ selectedUser.nombre }}
          </div>
          <div class="detail-item">
            <strong>Email:</strong> {{ selectedUser.usuario }}
          </div>
          <div class="detail-item">
            <strong>Rol:</strong> {{ getRoleName(selectedUser.rol_id) }}
          </div>
          <div class="detail-item">
            <strong>ID:</strong> {{ selectedUser.id }} <!-- Corregido: usar id en lugar de id_usuario -->
          </div>
          <div class="detail-item">
            <strong>Firebase UID:</strong> {{ selectedUser.firebase_uid }}
          </div>
          <div class="detail-item">
            <strong>Fecha de registro:</strong> {{ selectedUser.created_at | date:'dd/MM/yyyy HH:mm' }}
          </div>
        </div>
        
        <div class="modal-actions">
          <button class="btn btn-primary" (click)="resetPasswordInModal()" [disabled]="isLoading">
            <i class="fas fa-key"></i>
            Restablecer Contraseña
          </button>
          <button class="btn btn-outline-primary" (click)="closeUserDetails()" [disabled]="isLoading">
            Cerrar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>